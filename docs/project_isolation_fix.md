# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏

**–î–∞—Ç–∞:** 27 –º–∞—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –¥–µ—Ä–µ–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ **—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (DeviceTree, DeviceDetails –∏ –¥—Ä.) –Ω–µ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—É—â–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–ª –ø—Ä–æ–µ–∫—Ç "TEST_001" (0 —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
2. DeviceTree –ø—Ä–æ–¥–æ–ª–∂–∞–ª –∑–∞–≥—Ä—É–∂–∞—Ç—å **–≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –û—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ "DEFAULT" (2267 —É—Å—Ç—Ä–æ–π—Å—Ç–≤)

## üõ† –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Backend API

**–§–∞–π–ª:** `server/src/controllers/deviceReferenceController.ts`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `projectId` –≤ –º–µ—Ç–æ–¥—ã:
- `getAllDevices()` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –ø—Ä–æ–µ–∫—Ç—É
- `getDeviceTree()` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –ø—Ä–æ–µ–∫—Ç—É

```typescript
// –§–æ—Ä–º–∏—Ä—É–µ–º —É—Å–ª–æ–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É
const whereCondition: any = {};
if (projectId) {
  whereCondition.projectId = parseInt(projectId as string, 10);
}

const devices = await DeviceReference.findAll({
  where: whereCondition,
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
});
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend API

**–§–∞–π–ª:** `client/src/services/api.ts`

–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `projectId`:

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
getAllDevices: async (projectId?: number): Promise<DeviceReference[]> => {
  const params = projectId ? { projectId } : {};
  const response = await api.get('/device-references', { params });
  return response.data;
},

// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ä–µ–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤  
getDeviceTree: async (projectId?: number): Promise<TreeNode[]> => {
  const params = projectId ? { projectId } : {};
  const response = await api.get('/device-references/tree', { params });
  return response.data;
},
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ DeviceTree

**–§–∞–π–ª:** `client/src/components/DeviceTree.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–æ–≤:

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤
const { currentProjectId } = useProject();

// –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–∞
const fetchDevices = useCallback(async () => {
  const data = await deviceService.getAllDevices(currentProjectId || undefined);
  console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ${currentProjectId}:`, data.length, '—ç–ª–µ–º–µ–Ω—Ç–æ–≤');
  // ...
}, [buildCustomTreeCallback, currentProjectId]);

// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
useEffect(() => {
  fetchDevices();
}, [updateCounter, fetchDevices, currentProjectId]);
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ü—Ä–æ–µ–∫—Ç "TEST_001": –ø–æ–∫–∞–∑—ã–≤–∞–ª 2267 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ "DEFAULT"
- –ü—Ä–æ–µ–∫—Ç "WTP_002": –ø–æ–∫–∞–∑—ã–≤–∞–ª 2267 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ "DEFAULT"

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ü—Ä–æ–µ–∫—Ç "DEFAULT": –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 2267 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ‚úÖ
- –ü—Ä–æ–µ–∫—Ç "TEST_001": –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ‚úÖ  
- –ü—Ä–æ–µ–∫—Ç "WTP_002": –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ‚úÖ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü—Ä–æ–µ–∫—Ç DEFAULT (ID=1) - 2267 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
curl -X GET "http://localhost:3001/api/device-references?projectId=1"

# –ü—Ä–æ–µ–∫—Ç TEST_001 (ID=2) - 0 —É—Å—Ç—Ä–æ–π—Å—Ç–≤  
curl -X GET "http://localhost:3001/api/device-references?projectId=2"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: []
```

### Frontend —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–µ—Ä–µ–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `DeviceDetails` - –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- `SignalManagement` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞  
- `ImportData` - –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **Backend:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `projectId` –≤ SQL –∑–∞–ø—Ä–æ—Å–∞—Ö
2. **API:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `projectId` –≤ HTTP –∑–∞–ø—Ä–æ—Å–∞—Ö
3. **Frontend:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–æ–≤
4. **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–æ–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏! üéâ 